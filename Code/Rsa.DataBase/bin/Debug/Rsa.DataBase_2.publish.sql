/*
Deployment script for rsa

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "rsa"
:setvar DefaultFilePrefix "rsa"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL14.SQLEXPRESS\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL14.SQLEXPRESS\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Rename refactoring operation with key 58ccc9e6-0a27-499f-affc-b3cd145b898f is skipped, element [dbo].[VibrationAnalysis].[As] (SqlSimpleColumn) will not be renamed to AsDryRun';


GO
PRINT N'Rename refactoring operation with key 92a55be8-a737-4770-8502-1e00481ae832 is skipped, element [dbo].[CustomerEquipmentActivities].[PreviousStartDate] (SqlSimpleColumn) will not be renamed to PreviousServiceDate';


GO
PRINT N'Rename refactoring operation with key 8fb8933d-960e-4af9-831f-b07d796c39c8, c66ef1b1-e977-4c9c-85d8-4113530d68a6 is skipped, element [dbo].[CustomerEquipmentActivities].[Decanter] (SqlSimpleColumn) will not be renamed to DecanterSerialNumber';


GO
PRINT N'Rename refactoring operation with key 4778181c-0ee7-4ad1-b193-bcfa02915b55 is skipped, element [dbo].[VibrationAnalysis].[As] (SqlSimpleColumn) will not be renamed to AsProduction';


GO
PRINT N'Rename refactoring operation with key 442eb057-0842-4067-80dc-67401e4abfcb is skipped, element [dbo].[VibrationAnalysis].[VibrantAnalysisHeaderId] (SqlSimpleColumn) will not be renamed to VibrationAnalysisHeaderId';


GO
PRINT N'Rename refactoring operation with key 1ecdfd58-6afc-4a86-a88c-0430dfa3eb7a is skipped, element [dbo].[VibrationAnalysisHeaders].[Remarls] (SqlSimpleColumn) will not be renamed to Remarks';


GO
PRINT N'Creating [dbo].[CustomerEquipmentActivities]...';


GO
CREATE TABLE [dbo].[CustomerEquipmentActivities] (
    [Id]                   INT            IDENTITY (1, 1) NOT NULL,
    [Country]              NVARCHAR (100) NOT NULL,
    [Customer]             NVARCHAR (200) NOT NULL,
    [ServiceEngineer]      NVARCHAR (200) NOT NULL,
    [ReportNumber]         NVARCHAR (50)  NOT NULL,
    [PreviousServiceDate]  DATETIME       NOT NULL,
    [CurrentServiceDate]   DATETIME       NOT NULL,
    [ReportDate]           DATETIME       NOT NULL,
    [Equipment]            NVARCHAR (50)  NOT NULL,
    [SiteLocation]         NVARCHAR (100) NULL,
    [DecanterModel]        NVARCHAR (100) NULL,
    [DecanterSerialNumber] NVARCHAR (100) NOT NULL,
    [BowlSerialNumber]     NVARCHAR (100) NULL,
    [CustomerReference]    NVARCHAR (100) NULL,
    [RunningHours]         INT            NOT NULL,
    [Controller]           NVARCHAR (50)  NOT NULL,
    [HmiModel]             NVARCHAR (50)  NOT NULL,
    [HmiSwVersion]         NVARCHAR (50)  NOT NULL,
    [CpuModel]             NVARCHAR (50)  NOT NULL,
    [CpuSwVersion]         NVARCHAR (50)  NOT NULL,
    [ScopeOfWrok]          NVARCHAR (50)  NOT NULL,
    [ScoperOfWorkOthers]   NVARCHAR (50)  NULL,
    [WorkStatus]           NVARCHAR (50)  NOT NULL,
    [DecanterStatus]       NVARCHAR (50)  NOT NULL,
    [ReportHeaderId]       INT            NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[VibrationAnalysis]...';


GO
CREATE TABLE [dbo].[VibrationAnalysis] (
    [Id]                        INT            IDENTITY (1, 1) NOT NULL,
    [Parameter]                 NVARCHAR (200) NOT NULL,
    [Units]                     NVARCHAR (20)  NOT NULL,
    [BsDryRun]                  NVARCHAR (50)  NULL,
    [BsProduction]              NVARCHAR (50)  NULL,
    [AsDryRun]                  NVARCHAR (50)  NULL,
    [AsWaterTest]               NVARCHAR (50)  NULL,
    [AsProduction]              NVARCHAR (50)  NULL,
    [VibrationAnalysisHeaderId] INT            NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[VibrationAnalysisHeaders]...';


GO
CREATE TABLE [dbo].[VibrationAnalysisHeaders] (
    [Id]             INT            IDENTITY (1, 1) NOT NULL,
    [BsDryRunActive] BIT            NOT NULL,
    [BsProduction]   BIT            NOT NULL,
    [AsDryRun]       BIT            NOT NULL,
    [AsWaterTest]    BIT            NOT NULL,
    [AsProduction]   BIT            NOT NULL,
    [ReportHeaderId] INT            NOT NULL,
    [Remarks]        NVARCHAR (MAX) NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating unnamed constraint on [dbo].[VibrationAnalysisHeaders]...';


GO
ALTER TABLE [dbo].[VibrationAnalysisHeaders]
    ADD DEFAULT 0 FOR [BsDryRunActive];


GO
PRINT N'Creating unnamed constraint on [dbo].[VibrationAnalysisHeaders]...';


GO
ALTER TABLE [dbo].[VibrationAnalysisHeaders]
    ADD DEFAULT 0 FOR [BsProduction];


GO
PRINT N'Creating unnamed constraint on [dbo].[VibrationAnalysisHeaders]...';


GO
ALTER TABLE [dbo].[VibrationAnalysisHeaders]
    ADD DEFAULT 0 FOR [AsDryRun];


GO
PRINT N'Creating unnamed constraint on [dbo].[VibrationAnalysisHeaders]...';


GO
ALTER TABLE [dbo].[VibrationAnalysisHeaders]
    ADD DEFAULT 0 FOR [AsWaterTest];


GO
PRINT N'Creating unnamed constraint on [dbo].[VibrationAnalysisHeaders]...';


GO
ALTER TABLE [dbo].[VibrationAnalysisHeaders]
    ADD DEFAULT 0 FOR [AsProduction];


GO
PRINT N'Creating [dbo].[FK_CustomerEquipmentActivities_ReportHeaders]...';


GO
ALTER TABLE [dbo].[CustomerEquipmentActivities] WITH NOCHECK
    ADD CONSTRAINT [FK_CustomerEquipmentActivities_ReportHeaders] FOREIGN KEY ([ReportHeaderId]) REFERENCES [dbo].[ReportHeaders] ([Id]);


GO
PRINT N'Creating [dbo].[FK_VibrationAnalysis_VibrationAnalysisHeaders]...';


GO
ALTER TABLE [dbo].[VibrationAnalysis] WITH NOCHECK
    ADD CONSTRAINT [FK_VibrationAnalysis_VibrationAnalysisHeaders] FOREIGN KEY ([VibrationAnalysisHeaderId]) REFERENCES [dbo].[VibrationAnalysisHeaders] ([Id]);


GO
PRINT N'Creating [dbo].[FK_VibrationAnalysisHeaders_ReportHeaders]...';


GO
ALTER TABLE [dbo].[VibrationAnalysisHeaders] WITH NOCHECK
    ADD CONSTRAINT [FK_VibrationAnalysisHeaders_ReportHeaders] FOREIGN KEY ([ReportHeaderId]) REFERENCES [dbo].[ReportHeaders] ([Id]);


GO
-- Refactoring step to update target server with deployed transaction logs
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '92a55be8-a737-4770-8502-1e00481ae832')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('92a55be8-a737-4770-8502-1e00481ae832')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '8fb8933d-960e-4af9-831f-b07d796c39c8')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('8fb8933d-960e-4af9-831f-b07d796c39c8')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'c66ef1b1-e977-4c9c-85d8-4113530d68a6')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('c66ef1b1-e977-4c9c-85d8-4113530d68a6')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '58ccc9e6-0a27-499f-affc-b3cd145b898f')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('58ccc9e6-0a27-499f-affc-b3cd145b898f')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '4778181c-0ee7-4ad1-b193-bcfa02915b55')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('4778181c-0ee7-4ad1-b193-bcfa02915b55')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '442eb057-0842-4067-80dc-67401e4abfcb')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('442eb057-0842-4067-80dc-67401e4abfcb')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '1ecdfd58-6afc-4a86-a88c-0430dfa3eb7a')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('1ecdfd58-6afc-4a86-a88c-0430dfa3eb7a')

GO

GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[CustomerEquipmentActivities] WITH CHECK CHECK CONSTRAINT [FK_CustomerEquipmentActivities_ReportHeaders];

ALTER TABLE [dbo].[VibrationAnalysis] WITH CHECK CHECK CONSTRAINT [FK_VibrationAnalysis_VibrationAnalysisHeaders];

ALTER TABLE [dbo].[VibrationAnalysisHeaders] WITH CHECK CHECK CONSTRAINT [FK_VibrationAnalysisHeaders_ReportHeaders];


GO
PRINT N'Update complete.';


GO
